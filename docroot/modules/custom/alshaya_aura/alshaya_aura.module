<?php

/**
 * @file
 * Contains alshaya_aura.module.
 */

use Drupal\block\Entity\Block;

/**
 * Implements hook_theme().
 */
function alshaya_aura_theme() {
  $theme = [
    'aura_rewards_header' => [
      'variables' => [
        'learn_more_link' => '',
      ],
    ],
    'aura_pending_enrollment' => [
      'variables' => [],
    ],
  ];

  return $theme;
}

/**
 * Implements hook_page_attachments().
 */
function alshaya_aura_page_attachments(array &$page) {
  $settings['aura'] = [
    'enabled' => 1,
  ];
  $uid = \Drupal::currentUser()->id();
  $user = \Drupal::entityTypeManager()->getStorage('user')->load($uid);

  if (!empty($user)) {
    $settings['aura']['user_details'] = [
      'id' => $uid,
      'email' => \Drupal::currentUser()->getEmail(),
      'loyaltyStatus' => $user->get('field_aura_loyalty_status')->getString(),
    ];
  }

  $page['#attached']['drupalSettings'] = $settings;
}

/**
 * Implements hook_preprocess_alshaya_main_menu_level1() for menu template.
 */
function alshaya_aura_preprocess_alshaya_main_menu_level1(array &$variables) {
  $variables['not_logged_in'] = $variables['user']->id();

  $block = Block::load('aurarewardsheader');
  $block_content = \Drupal::entityTypeManager()
    ->getViewBuilder('block')
    ->view($block);
  $variables['aura_rewards_header'] = $block_content;
}
