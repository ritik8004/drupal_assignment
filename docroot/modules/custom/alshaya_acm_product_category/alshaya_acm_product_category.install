<?php

/**
 * @file
 * Contains install, update, uninstall hooks for alshaya_acm_product_category.
 */

use Drupal\field\Entity\FieldConfig;

/**
 * Implements hook_update_N().
 *
 * Adding new module 'jquery_minicolors' and adding two new fields for term
 * background and font color to the 'acq_product_category' vocabulary.
 */
function alshaya_acm_product_category_update_8003() {
  // Install jquery-minicolors module.
  if (!\Drupal::moduleHandler()->moduleExists('jquery_minicolors')) {
    \Drupal::service('module_installer')->install(['jquery_minicolors'], TRUE);
  }

  $configs = [
    'field.storage.taxonomy_term.field_term_font_color',
    'field.storage.taxonomy_term.field_term_background_color',
    'field.field.taxonomy_term.acq_product_category.field_term_font_color',
    'field.field.taxonomy_term.acq_product_category.field_term_background_color',
    'core.entity_form_display.taxonomy_term.acq_product_category.default',
    'core.entity_view_display.taxonomy_term.acq_product_category.default',
  ];
  alshaya_config_install_configs($configs, 'alshaya_acm_product_category', 'install');
}

/**
 * Implements hook_update_N().
 *
 * Adding new field for product category vocabulary for show/hide plp banner.
 * Install config for adding extra paragraph to main menu highlight field.
 */
function alshaya_acm_product_category_update_8002() {
  $configs = [
    'field.storage.taxonomy_term.field_promo_banner_for_mobile',
    'field.field.taxonomy_term.acq_product_category.field_promo_banner_for_mobile',
    'core.entity_form_display.taxonomy_term.acq_product_category.default',
    'core.entity_view_display.taxonomy_term.acq_product_category.default',
    'field.field.taxonomy_term.acq_product_category.field_main_menu_highlight',
    'core.entity_view_mode.paragraph.hightlight_image_186x184',
    'core.entity_view_display.paragraph.image_title_subtitle.hightlight_image_186x184',
  ];

  alshaya_config_install_configs($configs, 'alshaya_acm_product_category');
}

/**
 * Implements hook_update_N().
 *
 * Enable translation for promotional banner field in acq_product_category.
 */
function alshaya_acm_product_category_update_8001() {
  $config = \Drupal::configFactory()->getEditable('field.field.taxonomy_term.acq_product_category.field_promotion_banner');
  $config->set('translatable', TRUE);
  $config->save();

  $field = FieldConfig::loadByName('taxonomy_term', 'acq_product_category', 'field_promotion_banner');
  $field->setTranslatable(TRUE);
  $field->save();

  // Revert the view to have language filter.
  $reverter = \Drupal::service('config_update.config_update');
  $reverter->revert('view', 'plp_promotional_banner');
}
