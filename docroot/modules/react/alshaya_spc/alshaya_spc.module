<?php

/**
 * @file
 * Module file.
 */

use Drupal\block\Entity\Block;
use Drupal\Core\Session\AccountInterface;
use Drupal\Core\Access\AccessResult;

/**
 * Implements hook_preprocess_html().
 */
function alshaya_spc_preprocess_html(&$variables) {
  $currency_config = [
    'currency_code' => \Drupal::config('acq_commerce.currency')->get('currency_code'),
    'currency_code_position' => \Drupal::config('acq_commerce.currency')->get('currency_code_position'),
    'decimal_points' => \Drupal::config('acq_commerce.currency')->get('decimal_points'),
  ];

  $variables['#attached']['drupalSettings']['alshaya_spc']['currency_config'] = $currency_config;

  // Prepare middleware url.
  $host_url = \Drupal::request()->getHost();
  $variables['#attached']['drupalSettings']['alshaya_spc']['middleware_url'] = $host_url . '/middleware/app.php';
}

/**
 * Implements hook_block_access().
 */
function alshaya_spc_block_access(Block $block, $operation, AccountInterface $account) {
  // Page title block should not be accessible on cart page.
  if ($operation == 'view' && $block->getPluginId() == 'page_title_block') {
    return AccessResult::forbiddenIf(\Drupal::routeMatch()->getRouteName() == 'acq_cart.cart');
  }
}
