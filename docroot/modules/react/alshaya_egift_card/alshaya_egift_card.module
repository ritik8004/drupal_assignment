<?php

/**
 * @file
 * Contains alshaya_egift_card.module.
 */

 use Drupal\Core\Cache\Cache;

/**
 * Implements hook_alshaya_spc_checkout_build_alter().
 */
function alshaya_egift_card_alshaya_spc_checkout_build_alter(array &$build) {
  // Do not proceed if egift card is not enabled.
  $egiftCard_settings = \Drupal::service('alshaya_egift_card.egift_card_helper');
  $build['#attached']['drupalSettings']['egiftCard'] = [
    'enabled' => $egiftCard_settings->isEgiftCardEnabled(),
    'notSupportedPaymentMethods' => array_filter($egiftCard_settings->getNotSupportedPaymentMethods(), function($method) {
      return $method !== '0';
    }),
  ];
  $build['#cache']['tags'] = Cache::mergeTags($build['#cache']['tags'], \Drupal::config('alshaya_egift_card.settings')->getCacheTags());
  $build['#attached']['library'][] = 'alshaya_white_label/egift-card-checkout';

  $build['#strings'][] = [
    'key' => 'form_egift_card_number',
    'value' => t('Please enter your card number.', [], [
      'context' => 'egift'
    ]),
  ];
  $build['#strings'][] = [
    'key' => 'form_egift_code',
    'value' => t('Please enter the code.', [], [
      'context' => 'egift'
    ]),
  ];
  $build['#strings'][] = [
    'key' => 'form_egift_amount',
    'value' => t('Please enter the amount.', [], [
      'context' => 'egift'
    ]),
  ];
  $build['#strings'][] = [
    'key' => 'egift_insufficient_balance',
    'value' => t('Insufficient balance, Please topup the card or lower the redeem amount.', [], [
      'context' => 'egift'
    ]),
  ];
  $build['#strings'][] = [
    'key' => 'egift_amount_update_failed',
    'value' => t('Amount updated failed! Please try again after sometime.', [], [
      'context' => 'egift'
    ]),
  ];
  $build['#strings'][] = [
    'key' => 'egift_valid_amount',
    'value' => t('Please enter a valid amount.', [], [
      'context' => 'egift'
    ]),
  ];
  $build['#strings'][] = [
    'key' => 'egift_valid_card_number',
    'value' => t('Please enter a valid card number.', [], [
      'context' => 'egift',
    ]),
  ];
}

/**
 * Implements hook_alshaya_spc_cart_build_alter().
 */
function alshaya_egift_card_alshaya_spc_cart_build_alter(array &$build) {
  // Do not proceed if egift card is not enabled.
  $egiftCard_settings = \Drupal::service('alshaya_egift_card.egift_card_helper');
  // Add egift card settings in drupalSettings.
  $build['#attached']['drupalSettings']['egiftCard']['enabled'] = $egiftCard_settings->isEgiftCardEnabled();
  $build['#attached']['library'][] = 'alshaya_white_label/egift-cart';
  $build['#cache']['tags'] = Cache::mergeTags($build['#cache']['tags'], \Drupal::config('alshaya_egift_card.settings')->getCacheTags());
}

/**
 * Implements hook_theme().
 */
function alshaya_egift_card_theme() {
  return [
    'egift_balance_check_block' => [
      'variables' => [
        'block_title' => '',
        'block_description' => '',
        'check_balance_button' => '',
      ]
    ],
    'egift_topup_terms_conditions' => [
      'variables' => [
        'content' => '',
      ],
    ],
    'egift_topup_page' => [
      'variables' => [
        'terms_block_content' => '',
      ],
    ],
  ];
}
