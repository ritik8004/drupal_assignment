# Alshaya Behat Architecture

The idea behind this custom architecture is to avoid duplication of feature
files and maintaining feature files for multi-sites.  

## Directory Structure

```text

    ├── bin
    ├── build          # Compiled files by behat-build.sh
    ├── files          # Contains translations and any other media files.
    ├── src            # Code files that generate .feature files from templates
    ├── templates      # Contains templates (We (Developer/QA) use This folder)
    ├── vendor         # Generated by composer
    ├── behat-build.sh
    ├── behat.yml
    ├── composer.json
    ├── composer.lock
    └── README.md
  
```

### Inside `/templates/variables`

Contains `.yml` files with `variables` and `tests` keys. `variables` are used 
to replace token, Which we wrote in feature files with curly braces 
(i.e. `{userame}`), inside `template/features/*/*.feature` files.

Here's an example of sample `*.yml` file.
```yaml
variables:                         # Contains variables to replace with token
  username: 'kw-common@acquia.com'
  password: 'Common@123.com'
tests:                             # Contains a list of features to run.
  - 'login'                        # these contains real (*.feature) file names
  - 'sign-in'                      # without file extension.
```

Here are the naming convention of `*.yml` files to use: 
1. Inside `market` directory `*.yml` filename contain country code of 
2 characters.
2. Inside `brands` directory, there will always be a folder with brand name 
(`hm`, `mc`) and inside that folder `hm.yml, mc.yml` files respectively.
3. Inside `brands` directory, there will be an `env` and a `market` folder
  - `market` folder will contain `*.yml` file as described in first step. 
  - `env` dir contains envs folders `qa, uat, pprod` etc.
    - Inside `env` folder it contains `*.yml` file with env name. (`qa.yml, 
      uat.yml`) etc.
4. Inside `env` folder it contains another `market` folder as described in #1 
and #3.

Here's what actual structure will look like.

```text
    .
    ├── ...
    ├── templates
    │   ├── features
    │   ├── variables
    │   │   ├── common.yml
    │   │   ├── markets
    │   │   │   ├── kw.yml
    │   │   │   ├── sa.yml
    │   │   │   ├── ar.yml
    │   │   ├── brands
    │   │   │   ├── hm      
    │   │   │   │   ├── hm.yml
    │   │   │   │   ├── env
    │   │   │   │   │   ├── qa
    │   │   │   │   │   │   ├── qa.yml
    │   │   │   │   │   │   ├── markets
    │   │   │   │   │   ├── uat
    │   │   │   │   │   │   ├── uat.yml
    │   │   │   │   │   │   ├── markets
    │   │   │   │   │   │   │   ├── kw
    │   │   │   │   │   │   │   │   ├── kw.yml
    │   │   │   │   ├── markets
    │   │   │   │   │   ├── kw
    │   │   │   │   │   │   ├── kw.yml
    │   │   │   │   │   ├── sa
    │   │   │   │   │   │   ├── sa.yml
    │   │   │   ├── mc
    │   │   │   ├── vs
    │   └── behat.yml
    └── ...
```

### Inside `/templates/features`

Features folder contains only `*.feature` files and as the name suggests, These
are used as templates for actual feature files. so, these `*.feature` files
usually contains variables in curly braces (`{username}, {product_url}, 
{promo_block_title}` etc.) instead of actual value.

Here's a sample *.feature file:
```text
  Scenario: As an authenticated user,
  I should be able to sign in after providing valid credentials
    Given I am on homepage
    And I wait for the page to load
    When I close the popup
    And I wait for the page to load
    And I go to "/user/login"
    When I fill in "edit-name" with "{username}"
    And I fill in "edit-pass" with "{password}"
    And I press "sign in"
    Then I should see the link "{my_account_txt}"
    And I should see the link "{sign_out_txt}"
    And I should see "{recent_orders_txt}"
```

Here's the directory structure:
```text
    .
    ├── ...
    ├── templates             
    │   ├── features          
    │   │   ├── common                   # common feature files for all sites.
    │   │   │   ├── login.feature
    │   │   │   ├── contact.feature
    │   │   │   ├── advanced-page.feature
    │   │   │   ├── store-finder.feature
    │   │   ├── hm                       # common features for H&M brand
    │   │   │   ├── contact.feature
    │   │   │   ├── kw                   # features for H&M kuwait for all envs
    │   │   │   │   ├── login.feature
    │   │   │   │   ├── sign-up.feature
    │   │   │   │   ├── uat              # env specific feature.
    │   │   │   │   │   ├── login.feature
    │   │   │   ├── sa
    │   │   │   │   ├── login.feature
    │   │   │   │   ├── contact.feature 
    │   ├── variables
    │   └── behat.yml
    └── ...

```

## Local Setup

1. `cd behat_rework`
2. `composer install`
3. `npm install --prefix bin chromedriver`
4. `./behat-build.sh` This will generate feature files and 
5. (In a separate terminal window)
```bash
java -Dwebdriver.chrome.driver=bin/node_modules/chromedriver/bin/chromedriver -jar vendor/se/selenium-server-standalone/bin/selenium-server-standalone.jar
```
6. `bin/behat --profile=hm-kw-uat`

