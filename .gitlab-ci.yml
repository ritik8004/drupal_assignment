services:
  - mysql

variables:
  APP_NAME: ALSHAYA_WEB_FACTORY
  DOCKER_DRIVER: overlay2
  # Configure mysql service (https://hub.docker.com/_/mysql/)
  MYSQL_ROOT_PASSWORD: mysql_strong_password
  MYSQL_USER: drupal
  MYSQL_PASSWORD: drupal
  MYSQL_DATABASE: drupal
  COMPOSER_BIN: $CI_PROJECT_DIR/vendor/bin
  BLT_DIR: $CI_PROJECT_DIR/vendor/acquia/blt
  BUILD_DIR: $CI_PROJECT_DIR
  GITLAB_SCRIPT: $CI_PROJECT_DIR/ci/scripts/gitlab

stages:
  - build
  - test
  - deploy

before_script:
  # Update and install packages.
  - apt-get update && apt-get install
  - apt-get install rsync -y
  # PHP extensions: Soap:
  - docker-php-ext-install soap zip
  # Install all dependencies via composer
  - composer self-update --2
  - composer validate --no-check-all --ansi
  - composer install --ansi

Build:
  stage: build
  script:
    - echo "Building"
  tags:
    - large

Test:
  stage: test
  script:
    - echo "Testing"
  tags:
    - large

Develop:
  stage: deploy
  tags:
    - large
  environment:
    name: Develop
    url: https://www.qa2-alshaya.acsitefactory.com/
  only:
    - develop@alshaya01/alshaya-pso
    - merge-requests
